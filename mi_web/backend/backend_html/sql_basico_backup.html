<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Base de Datos M√©dica - SQL B√°sico</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .sql-button {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .sql-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .sql-button.insert { background: linear-gradient(135deg, #55a3ff 0%, #003d82 100%); }
        .sql-button.select { background: linear-gradient(135deg, #00b894 0%, #00a085 100%); }
        .sql-button.update { background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%); }
        .sql-button.delete { background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%); }
        .sql-button.create { background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); }
        .sql-button.drop { background: linear-gradient(135deg, #fd7675 0%, #c0392b 100%); }
        
        .query-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .query-container h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .sql-query {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-x: auto;
            margin-bottom: 15px;
        }
        
        .result-area {
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 15px;
            min-height: 100px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .copy-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .copy-btn:hover {
            background: #229954;
        }
        
        .execute-btn-sql {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .execute-btn-sql:hover {
            background: #c0392b;
        }
        
        .hidden {
            display: none;
        }
        
        .execute-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .execute-btn:hover {
            background: #c0392b;
        }
        
        .info-box {
            background: #e8f4f8;
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-box h3 {
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sistema de Base de Datos M√©dica</h1>
            <p>Consultas SQL B√°sicas - Pr√°ctica Estudiantil</p>
        </div>
        
        <div class="content">
            <div class="info-box">
                <h3>ÔøΩ Instrucciones</h3>
                <p>Haz clic en cualquier bot√≥n para ver y ejecutar consultas SQL b√°sicas. Estas consultas te permiten realizar operaciones fundamentales en la base de datos m√©dica.</p>
                <p><strong>Nota:</strong> Si es la primera vez que usas el sistema, haz clic en "Cargar Datos" para cargar datos de ejemplo.</p>
                <button class="execute-btn" onclick="populateDatabase()" style="margin-top: 10px;">ÔøΩ Cargar Datos</button>
                <div id="populate-result" style="margin-top: 10px; font-weight: bold;"></div>
            </div>
            
                        <div class="section">
                <h2>ÔøΩ Operaciones SQL B√°sicas</h2>
                <div class="buttons-grid">
                    <button class="sql-button insert" onclick="showQuery('insert')">
                        INSERT - Insertar Datos
                    </button>
                    <button class="sql-button select" onclick="showQuery('select')">
                        ÔøΩ SELECT - Consultar Datos
                    </button>
                    <button class="sql-button update" onclick="showQuery('update')">
                        UPDATE - Actualizar Datos
                    </button>
                    <button class="sql-button delete" onclick="showQuery('delete')">
                        DELETE - Eliminar Datos
                    </button>
                    <button class="sql-button create" onclick="showQuery('create')">
                        üî® CREATE - Crear Tabla
                    </button>
                    <button class="sql-button drop" onclick="showQuery('drop')">
                        DROP - Eliminar Tabla
                    </button>
                </div>
            </div>
            
            <!-- Query Containers -->
            <div id="insert-query" class="query-container hidden">
                <h3>üìù INSERT - Insertar Nuevo Paciente</h3>
                <div class="form-group">
                    <label>RUT del Paciente:</label>
                    <input type="text" id="insert-rut" placeholder="12345678-9" value="98765432-1">
                </div>
                <div class="form-group">
                    <label>Nombre:</label>
                    <input type="text" id="insert-nombre" placeholder="Nombre completo" value="Juan Carlos Mendoza">
                </div>
                <div class="form-group">
                    <label>Fecha de Nacimiento:</label>
                    <input type="date" id="insert-fecha-nac" value="1940-05-15">
                </div>
                <div class="form-group">
                    <label>M√©dico Tratante:</label>
                    <input type="text" id="insert-medico" placeholder="Dr. Nombre" value="Dr. Ricardo Mart√≠nez">
                </div>
                <div class="form-group">
                    <label>Diagn√≥stico:</label>
                    <textarea id="insert-diagnostico" placeholder="Diagn√≥stico principal" rows="3">Hipertensi√≥n arterial, Control cardiol√≥gico</textarea>
                </div>
                <button class="execute-btn" onclick="generateInsertQuery()">Generar Query INSERT</button>
                <div class="sql-query" id="insert-sql">
-- La consulta aparecer√° aqu√≠
                </div>
                <button class="copy-btn" onclick="copyToClipboard('insert-sql')">Copiar</button>
                <button class="execute-btn-sql" onclick="executeQuery('insert-sql', 'insert-result')">Ejecutar</button>
                <div class="result-area" id="insert-result">
Resultado de la inserci√≥n aparecer√° aqu√≠...
                </div>
            </div>
            
            <div id="select-query" class="query-container hidden">
                <h3>SELECT - Consultar Pacientes</h3>
                <div class="form-group">
                    <label>Tipo de Consulta:</label>
                    <select id="select-type" onchange="generateSelectQuery()">
                        <option value="all">Todos los pacientes</option>
                        <option value="by-doctor">Por m√©dico tratante</option>
                        <option value="by-age">Por rango de edad</option>
                        <option value="recent">Ingresos recientes</option>
                        <option value="medications">Pacientes con medicamentos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Par√°metro (si aplica):</label>
                    <input type="text" id="select-param" placeholder="Ej: Dr. Ricardo Mart√≠nez" value="Dr. Ricardo Mart√≠nez">
                </div>
                <button class="execute-btn" onclick="generateSelectQuery()">Generar Query SELECT</button>
                <div class="sql-query" id="select-sql">
-- Seleccionar todos los pacientes
SELECT rut, nombre, fecha_nacimiento, 
       (strftime('%Y', 'now') - strftime('%Y', fecha_nacimiento)) AS edad,
       medico_tratante, diagnostico
FROM residentes 
ORDER BY nombre;
                </div>
                <button class="copy-btn" onclick="copyToClipboard('select-sql')">Copiar</button>
                <button class="execute-btn-sql" onclick="executeQuery('select-sql', 'select-result')">Ejecutar</button>
                <div class="result-area" id="select-result">
Resultados de la consulta aparecer√°n aqu√≠...
                </div>
            </div>
            
            <div id="update-query" class="query-container hidden">
                <h3>UPDATE - Actualizar Informaci√≥n del Paciente</h3>
                <div class="form-group">
                    <label>RUT del Paciente a Actualizar:</label>
                    <input type="text" id="update-rut" placeholder="12345678-9" value="12345678-9">
                </div>
                <div class="form-group">
                    <label>Campo a Actualizar:</label>
                    <select id="update-field">
                        <option value="medico_tratante">M√©dico Tratante</option>
                        <option value="diagnostico">Diagn√≥stico</option>
                        <option value="proximo_control">Pr√≥ximo Control</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nuevo Valor:</label>
                    <input type="text" id="update-value" placeholder="Nuevo valor" value="Dra. Carolina S√°nchez">
                </div>
                <button class="execute-btn" onclick="generateUpdateQuery()">Generar Query UPDATE</button>
                <div class="sql-query" id="update-sql">
-- La consulta de actualizaci√≥n aparecer√° aqu√≠
                </div>
                <button class="copy-btn" onclick="copyToClipboard('update-sql')">Copiar</button>
                <button class="execute-btn-sql" onclick="executeQuery('update-sql', 'update-result')">Ejecutar</button>
                <div class="result-area" id="update-result">
Resultado de la actualizaci√≥n aparecer√° aqu√≠...
                </div>
            </div>
            
            <div id="delete-query" class="query-container hidden">
                <h3>DELETE - Eliminar Registros</h3>
                <div class="form-group">
                    <label>Tipo de Eliminaci√≥n:</label>
                    <select id="delete-type" onchange="generateDeleteQuery()">
                        <option value="patient">Eliminar paciente espec√≠fico</option>
                        <option value="old-records">Eliminar registros vitales antiguos</option>
                        <option value="expired-meds">Eliminar medicamentos vencidos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Par√°metro:</label>
                    <input type="text" id="delete-param" placeholder="RUT o fecha" value="98765432-1">
                </div>
                <button class="execute-btn" onclick="generateDeleteQuery()">Generar Query DELETE</button>
                <div class="sql-query" id="delete-sql">
-- ‚ö†Ô∏è CUIDADO: Esta operaci√≥n eliminar√° datos permanentemente
-- Eliminar paciente espec√≠fico (primero eliminar registros relacionados)
DELETE FROM medicamentos WHERE rut_residente = '98765432-1';
DELETE FROM registros_vitales WHERE rut_residente = '98765432-1';
DELETE FROM residentes WHERE rut = '98765432-1';
                </div>
                <button class="copy-btn" onclick="copyToClipboard('delete-sql')">Copiar</button>
                <button class="execute-btn-sql" onclick="executeQuery('delete-sql', 'delete-result')">Ejecutar</button>
                <div class="result-area" id="delete-result">
‚ö†Ô∏è ADVERTENCIA: Las operaciones DELETE son irreversibles. Aseg√∫rate de hacer backup antes de ejecutar.
                </div>
            </div>
            
            <div id="create-query" class="query-container hidden">
                <h3>CREATE TABLE - Crear Nueva Tabla</h3>
                <div class="form-group">
                    <label>Tipo de Tabla:</label>
                    <select id="create-type" onchange="generateCreateQuery()">
                        <option value="alergias">Tabla de Alergias</option>
                        <option value="funcionarios">Tabla de Funcionarios</option>
                        <option value="habitaciones">Tabla de Habitaciones</option>
                    </select>
                </div>
                <button class="execute-btn" onclick="generateCreateQuery()">Generar Query CREATE TABLE</button>
                <div class="sql-query" id="create-sql">
-- Crear tabla de alergias para pacientes
CREATE TABLE alergias (
    id INT AUTO_INCREMENT PRIMARY KEY,
    rut_residente VARCHAR(12) NOT NULL,
    alergia VARCHAR(100) NOT NULL,
    severidad ENUM('Leve', 'Moderada', 'Severa') DEFAULT 'Leve',
    fecha_deteccion DATE,
    descripcion TEXT,
    activa BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (rut_residente) REFERENCES residentes(rut) ON DELETE CASCADE
);
                </div>
                <button class="copy-btn" onclick="copyToClipboard('create-sql')">Copiar</button>
                <button class="execute-btn-sql" onclick="executeQuery('create-sql', 'create-result')">Ejecutar</button>
                <div class="result-area" id="create-result">
La tabla se crear√° con la estructura mostrada arriba...
                </div>
            </div>
            
            <div id="drop-query" class="query-container hidden">
                <h3>üí• DROP TABLE - Eliminar Tabla</h3>
                <div class="form-group">
                    <label>Tabla a Eliminar:</label>
                    <select id="drop-table">
                        <option value="alergias">alergias</option>
                        <option value="funcionarios">funcionarios</option>
                        <option value="habitaciones">habitaciones</option>
                    </select>
                </div>
                <button class="execute-btn" onclick="generateDropQuery()">Generar Query DROP TABLE</button>
                <div class="sql-query" id="drop-sql">
-- ‚ö†Ô∏è PELIGRO: Esta operaci√≥n elimina toda la tabla y sus datos
-- Verificar primero si la tabla existe
DROP TABLE IF EXISTS alergias;
                </div>
                <button class="copy-btn" onclick="copyToClipboard('drop-sql')">Copiar</button>
                <button class="execute-btn-sql" onclick="executeQuery('drop-sql', 'drop-result')">Ejecutar</button>
                <div class="result-area" id="drop-result">
‚ö†Ô∏è PELIGRO: DROP TABLE elimina completamente la tabla y todos sus datos. Esta operaci√≥n NO se puede deshacer.
                </div>
            </div>
        </div>
    </div>

    <script>
        function showQuery(type) {
            // Ocultar todos los containers
            const containers = document.querySelectorAll('.query-container');
            containers.forEach(container => {
                container.classList.add('hidden');
            });
            
            // Mostrar el container seleccionado
            const selectedContainer = document.getElementById(type + '-query');
            selectedContainer.classList.remove('hidden');
            
            // Scroll suave al container
            selectedContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        function generateInsertQuery() {
            const rut = document.getElementById('insert-rut').value;
            const nombre = document.getElementById('insert-nombre').value;
            const fechaNac = document.getElementById('insert-fecha-nac').value;
            const medico = document.getElementById('insert-medico').value;
            const diagnostico = document.getElementById('insert-diagnostico').value;
            
            const today = new Date().toISOString().split('T')[0];
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const proximoControl = nextMonth.toISOString().split('T')[0];
            
            const query = `-- Insertar nuevo paciente
INSERT INTO residentes (rut, nombre, fecha_nacimiento, fecha_ingreso, medico_tratante, proximo_control, diagnostico) 
VALUES (
    '${rut}', 
    '${nombre}', 
    '${fechaNac}', 
    '${today}',
    '${medico}', 
    '${proximoControl}',
    '${diagnostico}'
);`;
            
            document.getElementById('insert-sql').textContent = query;
            document.getElementById('insert-result').textContent = `‚úÖ Se insertar√≠a el paciente ${nombre} con RUT ${rut} en la base de datos.`;
        }
        
        function generateSelectQuery() {
            const type = document.getElementById('select-type').value;
            const param = document.getElementById('select-param').value;
            let query = '';
            
            switch(type) {
                case 'all':
                    query = `-- Consultar todos los pacientes con informaci√≥n completa
SELECT rut, 
       nombre, 
       fecha_nacimiento, 
       (strftime('%Y', 'now') - strftime('%Y', fecha_nacimiento)) AS edad,
       fecha_ingreso,
       medico_tratante, 
       diagnostico,
       proximo_control
FROM residentes 
ORDER BY nombre;`;
                    break;
                case 'by-doctor':
                    query = `-- Consultar pacientes por m√©dico con informaci√≥n completa
SELECT rut, 
       nombre, 
       fecha_nacimiento,
       (strftime('%Y', 'now') - strftime('%Y', fecha_nacimiento)) AS edad,
       fecha_ingreso, 
       diagnostico,
       proximo_control
FROM residentes 
WHERE medico_tratante = '${param}'
ORDER BY fecha_ingreso DESC;`;
                    break;
                case 'by-age':
                    query = `-- Consultar pacientes mayores de 80 a√±os con informaci√≥n completa
SELECT rut, 
       nombre, 
       fecha_nacimiento,
       (strftime('%Y', 'now') - strftime('%Y', fecha_nacimiento)) AS edad,
       fecha_ingreso,
       medico_tratante,
       diagnostico,
       proximo_control
FROM residentes 
WHERE (strftime('%Y', 'now') - strftime('%Y', fecha_nacimiento)) > 80
ORDER BY fecha_nacimiento;`;
                    break;
                case 'recent':
                    query = `-- Consultar ingresos recientes (√∫ltimos 30 d√≠as) con informaci√≥n completa
SELECT rut, 
       nombre, 
       fecha_nacimiento,
       (strftime('%Y', 'now') - strftime('%Y', fecha_nacimiento)) AS edad,
       fecha_ingreso, 
       medico_tratante, 
       diagnostico,
       proximo_control
FROM residentes 
WHERE fecha_ingreso >= date('now', '-30 days')
ORDER BY fecha_ingreso DESC;`;
                    break;
                case 'medications':
                    query = `-- Consultar pacientes con medicamentos activos
SELECT DISTINCT r.rut, r.nombre, r.medico_tratante
FROM residentes r
INNER JOIN medicamentos m ON r.rut = m.rut_residente
WHERE m.fecha_termino IS NULL OR m.fecha_termino > date('now')
ORDER BY r.nombre;`;
                    break;
            }
            
            document.getElementById('select-sql').textContent = query;
            document.getElementById('select-result').textContent = `üìä La consulta retornar√≠a los registros que coincidan con el criterio seleccionado.`;
        }
        
        function generateUpdateQuery() {
            const rut = document.getElementById('update-rut').value;
            const field = document.getElementById('update-field').value;
            const value = document.getElementById('update-value').value;
            
            const query = `-- Actualizar informaci√≥n del paciente
UPDATE residentes 
SET ${field} = '${value}'
WHERE rut = '${rut}';`;
            
            document.getElementById('update-sql').textContent = query;
            document.getElementById('update-result').textContent = `‚úÖ Se actualizar√≠a el campo ${field} del paciente con RUT ${rut} al valor: ${value}`;
        }
        
        function generateDeleteQuery() {
            const type = document.getElementById('delete-type').value;
            const param = document.getElementById('delete-param').value;
            let query = '';
            
            switch(type) {
                case 'patient':
                    query = `-- ‚ö†Ô∏è Eliminar paciente (primero eliminar registros relacionados manualmente)
-- Para eliminar un paciente completamente, ejecutar en este orden:
-- 1. DELETE FROM registros_vitales WHERE rut_residente = '${param}';
-- 2. DELETE FROM medicamentos WHERE rut_residente = '${param}';
-- 3. DELETE FROM residentes WHERE rut = '${param}';

-- Esta consulta solo elimina el paciente (puede fallar si hay registros relacionados)
DELETE FROM residentes WHERE rut = '${param}';`;
                    break;
                case 'old-records':
                    query = `-- Eliminar registros vitales antiguos (m√°s de 1 a√±o)
DELETE FROM registros_vitales 
WHERE fecha < date('now', '-1 year');`;
                    break;
                case 'expired-meds':
                    query = `-- Eliminar medicamentos vencidos
DELETE FROM medicamentos 
WHERE fecha_termino IS NOT NULL 
AND fecha_termino < date('now', '-6 months');`;
                    break;
            }
            
            document.getElementById('delete-sql').textContent = query;
            document.getElementById('delete-result').textContent = `‚ö†Ô∏è CUIDADO: Esta operaci√≥n eliminar√° datos permanentemente. Siempre hacer backup antes de ejecutar DELETE.`;
        }
        
        function generateCreateQuery() {
            const type = document.getElementById('create-type').value;
            let query = '';
            
            switch(type) {
                case 'alergias':
                    query = `-- Crear tabla de alergias para pacientes
CREATE TABLE alergias (
    id INT AUTO_INCREMENT PRIMARY KEY,
    rut_residente VARCHAR(12) NOT NULL,
    alergia VARCHAR(100) NOT NULL,
    severidad ENUM('Leve', 'Moderada', 'Severa') DEFAULT 'Leve',
    fecha_deteccion DATE,
    descripcion TEXT,
    activa BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (rut_residente) REFERENCES residentes(rut) ON DELETE CASCADE
);`;
                    break;
                case 'funcionarios':
                    query = `-- Crear tabla de funcionarios
CREATE TABLE funcionarios (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    rut TEXT NOT NULL UNIQUE,
    nombre TEXT NOT NULL,
    cargo TEXT NOT NULL,
    turno TEXT,
    telefono TEXT,
    fecha_ingreso DATE
);`;
                    break;
                case 'habitaciones':
                    query = `-- Crear tabla de habitaciones
CREATE TABLE habitaciones (
    numero_habitacion TEXT PRIMARY KEY,
    tipo_habitacion TEXT NOT NULL,
    estado TEXT DEFAULT 'Disponible',
    rut_residente TEXT,
    fecha_asignacion DATE,
    FOREIGN KEY (rut_residente) REFERENCES residentes(rut)
);`;
                    break;
            }
            
            document.getElementById('create-sql').textContent = query;
            document.getElementById('create-result').textContent = `‚úÖ Se crear√≠a la tabla ${type} con la estructura mostrada.`;
        }
        
        function generateDropQuery() {
            const table = document.getElementById('drop-table').value;
            
            const query = `-- ‚ö†Ô∏è PELIGRO: Eliminar tabla completamente
-- Verificar primero si existen registros
SELECT COUNT(*) FROM ${table};

-- Eliminar la tabla (IRREVERSIBLE)
DROP TABLE IF EXISTS ${table};`;
            
            document.getElementById('drop-sql').textContent = query;
            document.getElementById('drop-result').textContent = `üö® PELIGRO: Se eliminar√≠a completamente la tabla ${table} y TODOS sus datos. Esta operaci√≥n NO se puede deshacer.`;
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                // Mostrar confirmaci√≥n temporal
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copiado!';
                btn.style.background = '#27ae60';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                console.error('Error al copiar: ', err);
                alert('Error al copiar al portapapeles');
            });
        }
        
        async function executeQuery(queryElementId, resultElementId) {
            const queryElement = document.getElementById(queryElementId);
            const resultElement = document.getElementById(resultElementId);
            const query = queryElement.textContent.trim();
            
            if (!query) {
                resultElement.textContent = 'Error: No hay consulta para ejecutar';
                return;
            }
            
            try {
                resultElement.textContent = 'Paso 1: Enviando consulta al servidor...';
                
                const response = await fetch('/api/execute-sql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });
                
                resultElement.textContent = 'Paso 2: Procesando consulta en la base de datos...';
                
                const result = await response.json();
                
                if (result.success) {
                    if (result.data && result.data.length > 0) {
                        // Mostrar proceso para SELECT con tabla HTML
                        let output = `<div style="margin-bottom: 15px;">`;
                        output += `<strong>Paso 3:</strong> Consulta SELECT ejecutada exitosamente<br>`;
                        output += `<strong>Paso 4:</strong> Se encontraron ${result.count} registros<br>`;
                        output += `<strong>Paso 5:</strong> Procesando datos...<br>`;
                        output += `<strong>Paso 6:</strong> Mostrando resultados en tabla:<br>`;
                        output += `</div>`;
                        
                        // Crear tabla HTML
                        output += `<table border="1" style="width: 100%; border-collapse: collapse; margin-top: 10px;">`;
                        
                        // Encabezados de la tabla
                        if (result.data.length > 0) {
                            output += `<thead style="background-color: #f8f9fa;"><tr>`;
                            Object.keys(result.data[0]).forEach(key => {
                                output += `<th style="padding: 8px; text-align: left; border: 1px solid #dee2e6;">${key}</th>`;
                            });
                            output += `</tr></thead>`;
                        }
                        
                        // Filas de datos
                        output += `<tbody>`;
                        result.data.forEach((row, index) => {
                            output += `<tr style="background-color: ${index % 2 === 0 ? '#ffffff' : '#f8f9fa'};">`;
                            Object.values(row).forEach(value => {
                                output += `<td style="padding: 8px; border: 1px solid #dee2e6;">${value || 'NULL'}</td>`;
                            });
                            output += `</tr>`;
                        });
                        output += `</tbody></table>`;
                        
                        output += `<div style="margin-top: 10px; font-style: italic; color: #666;">`;
                        output += `‚úÖ Consulta completada exitosamente - ${result.data.length} registro(s) mostrado(s)`;
                        output += `</div>`;
                        
                        resultElement.innerHTML = output;
                    } else if (result.count === 0) {
                        // Proceso para consultas sin resultados
                        let output = `<div style="margin-bottom: 15px;">`;
                        output += `<strong>Paso 3:</strong> Consulta ejecutada exitosamente<br>`;
                        output += `<strong>Paso 4:</strong> No se encontraron registros<br>`;
                        output += `<strong>Paso 5:</strong> La tabla est√° vac√≠a o no coincide con los criterios<br><br>`;
                        output += `<em>Sugerencia: Si es la primera vez, haz clic en "Cargar Datos"</em>`;
                        output += `</div>`;
                        resultElement.innerHTML = output;
                    } else {
                        // Proceso para INSERT, UPDATE, DELETE
                        let output = `<div style="margin-bottom: 15px;">`;
                        output += `<strong>Paso 3:</strong> Consulta ejecutada exitosamente<br>`;
                        output += `<strong>Paso 4:</strong> Operaci√≥n completada<br>`;
                        output += `<strong>Paso 5:</strong> Filas afectadas: ${result.affected_rows || 0}<br>`;
                        if (query.toUpperCase().includes('INSERT')) {
                            output += `<strong>Paso 6:</strong> Nuevo registro agregado a la base de datos`;
                        } else if (query.toUpperCase().includes('UPDATE')) {
                            output += `<strong>Paso 6:</strong> Registro actualizado en la base de datos`;
                        } else if (query.toUpperCase().includes('DELETE')) {
                            output += `<strong>Paso 6:</strong> Registro eliminado de la base de datos`;
                        } else if (query.toUpperCase().includes('CREATE')) {
                            output += `<strong>Paso 6:</strong> Nueva tabla creada en la base de datos`;
                        } else if (query.toUpperCase().includes('DROP')) {
                            output += `<strong>Paso 6:</strong> Tabla eliminada de la base de datos`;
                        }
                        output += `</div>`;
                        resultElement.innerHTML = output;
                    }
                } else {
                    resultElement.innerHTML = `<div style="color: red;"><strong>Error en Paso 3:</strong> ${result.error}</div>`;
                }
            } catch (error) {
                console.error('Error:', error);
                resultElement.innerHTML = `<div style="color: red;"><strong>Error en Paso 1:</strong> No se pudo conectar al servidor - ${error.message}</div>`;
            }
        }

        async function populateDatabase() {
            const resultDiv = document.getElementById('populate-result');
            resultDiv.innerHTML = 'Cargando datos de ejemplo... ‚è≥';
            resultDiv.style.color = '#007bff';

            try {
                const response = await fetch('/api/populate-db', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = '‚úÖ ' + result.message;
                    resultDiv.style.color = '#28a745';
                } else {
                    resultDiv.innerHTML = 'Error: ' + result.error;
                    resultDiv.style.color = '#dc3545';
                }
            } catch (error) {
                resultDiv.innerHTML = 'Error de conexi√≥n: ' + error.message;
                resultDiv.style.color = '#dc3545';
            }
        }
        
        // Inicializar la primera consulta
        document.addEventListener('DOMContentLoaded', function() {
            generateSelectQuery();
        });
    </script>
</body>
</html>